<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Prueba WebSocket</title>
</head>
<body>

<h1>ğŸš€ Cliente de Prueba WebSocket</h1>

<p id="estado">â³ Conectando...</p>

<button onclick="enviarGPS()">ğŸ“ Enviar GPS</button>
<button onclick="enviarEstado()">âœ… Enviar Estado</button>
<button onclick="enviarTexto()">ğŸ’¬ Enviar Texto</button>

<pre id="log"></pre>

<script>
let ws;
let conectado = false;

function conectar() {
  ws = new WebSocket("wss://rutasws-f6hhc6bmekbbekfe.mexicocentral-01.azurewebsites.net/");

  ws.onopen = () => {
    conectado = true;
    document.getElementById("estado").textContent = "âœ… Conectado";
    log("âœ… Conectado al servidor");
  };

  ws.onerror = (e) => {
    document.getElementById("estado").textContent = "âŒ Error de conexiÃ³n";
    log("âŒ Error de conexiÃ³n");
  };

  ws.onclose = () => {
    conectado = false;
    document.getElementById("estado").textContent = "ğŸ”„ Reconectando...";
    log("ğŸ”„ ConexiÃ³n cerrada, reconectando...");
    setTimeout(conectar, 2000);
  };

  ws.onmessage = (e) => {
    log("ğŸ“¥ Servidor: " + e.data);
  };
}

function enviarGPS() {
  if (!conectado) return alert("âŒ AÃºn no conectado");
  ws.send(JSON.stringify({
    tipo: "gps",
    lat: 19.4326,
    lng: -99.1332
  }));
  log("ğŸ“ GPS enviado");
}

function enviarEstado() {
  if (!conectado) return alert("âŒ AÃºn no conectado");
  ws.send(JSON.stringify({
    tipo: "estado",
    valor: "activo"
  }));
  log("âœ… Estado enviado");
}

function enviarTexto() {
  if (!conectado) return alert("âŒ AÃºn no conectado");
  ws.send(JSON.stringify({
    tipo: "texto",
    mensaje: "Hola desde la pÃ¡gina de prueba"
  }));
  log("ğŸ’¬ Texto enviado");
}

function log(msg) {
  document.getElementById("log").textContent += msg + "\n";
}

conectar();
</script>

</body>
</html>
